**Japanese** | [English](6.md)

# カウンターポンプ nterm=6

nterm=6, w=5, パス長=257

## メカニズム

カウンターポンプは y 座標をカウンタとして非対称に蓄積・放出する。
nterm = n = 6（各辺6ターミナル）、復路幅 w = 5 の場合：

- **往路サイクル**: y をゆっくり蓄積しながら東へ移動。
  各サイクル: (+1, +4) の変位を8ステップで実行。
- **下降**: N0->S0 で y を高速消費（1ステップ/1y）。
- **クライム**: S-N 鎖に再突入し、復路用の N1 に到達。
- **復路**: w=5 ホップのサブサイクルで西に移動、各回 y を1消費。

### Haskell

```haskell
-- カウンターポンプ nterm=6, w=5
-- レジスタ: x（水平）, y（垂直）
-- 初期呼出: cpump6 (0, 1, 0)
-- 総ステップ数: 257

cpump6 :: (Int, Int, Int) -> (Int, Int, Int)
--        x    y    pc       x    y    pc

-- 往路サイクル: x+=1, y+=4（8ステップ/サイクル）
cpump6 (  x,   y,   0) = cpump6 (  x,   y,   1)     -- W0->N0: ブロック進入
cpump6 (  x,   y,   1) = cpump6 (  x, y+3,   2)     -- N0->N4, S4->N3->N2->N1 を登る
cpump6 (  x,   y,   2) = cpump6 (x-1,   y,   3)     -- S1->E5, E5->W4: 西へ
cpump6 (  x,   y,   3) = cpump6 (x+1,   y,   0)     -- W4->E0: 東へバウンス

-- 下降: 1ステップで y -= 1（N0->S0）
cpump6 (  x,   y,   4) = cpump6 (  x, y-1,   4)     -- N0->S0: 下降
-- （往路から下降への遷移は BFS の最適性によって決定）

-- 下降後のクライム: N0->N4, S4->N3, S3->N2, S2->N1
cpump6 (  x,   y,   5) = cpump6 (  x, y+3,   6)     -- N1 まで登る

-- 復路サブサイクル: x -= 5, y -= 1（6ステップ/サイクル）
-- N1->W0, E0->W5, E5->W4, E4->W3, E3->W2, その後 E2->S1
cpump6 (  x,   y,   6) = cpump6 (x-5, y-1,   6)     -- 非最終復路
-- 最終復路: N1->W0, E0->W5, E5->W4, E4->W3, E3->W2, W2->W1
cpump6 (  x,   y,   6) =       (x-5,   y,  -1)      -- ゴールで停止 (0,1)
```

注: 上記の Haskell は簡略化モデル。実際の迷路は単一のプログラムカウンタ
（ターミナルインデックス）を使用し、BFS ソルバーが最適なフェーズ遷移を決定する。
往路と下降は共に N0 ターミナルを使用し、BFS が最短パスに基づいて
N0->N4（往路/クライム）か N0->S0（下降）を選択する。

### ポート構成

```
往路サイクル（8ステップ/サイクル）:
  W0 -> N0         西からブロックに進入
  N0 -> N4         高インデックスへジャンプ
  S4 -> N3         y+1（境界越え）
  S3 -> N2         y+1
  S2 -> N1         y+1
  S1 -> E5         東側へ切替
  E5 -> W4         西へ（x-1）
  W4 -> E0         東へバウンス（x+1）

下降:
  N0 -> S0         y-1（反復）

復路チェーン（w=5 西方向ホップ）:
  N1 -> W0         x-1（ホップ1）
  E0 -> W5         x-1（ホップ2）
  E5 -> W4         x-1（ホップ3、往路と共用）
  E4 -> W3         x-1（ホップ4）
  E3 -> W2         x-1（ホップ5）

終了条件:
  E2 -> S1         非最終: y-1、N1 に戻りループ
  W2 -> W1         最終: ゴール E1@(0,1) へ退出
```

### パラメータ

| パラメータ | 値 |
|---|---|
| nterm (n) | 6 |
| 復路幅 (w) | 5 = n-1 |
| 往路サイクル数 (f) | w(n-2)-1 = 19 |
| 下降ステップ数 (d) | (n-2)f = 76 |
| 復路サブサイクル数 (r) | n-3 = 3 |
| 総ステップ数 (T) | w(2n^2-3n-2)-3 = 257 |

### パス構成

```
フェーズ           変位           ステップ 回数    小計
往路サイクル       (+1, +4)       8       19      152
遷移               (+1,  0)       1       1       1
下降               ( 0, -1)       1       76      76
クライム           ( 0, +3)       4       1       4
復路（非最終）     (-5, -1)       6       3       18
復路（最終）       (-5,  0)       6       1       6
                                          合計:   257
```

### 成長

n = nterm として:

```
w = 3 (固定)   : T = 3(2n^2 - 3n - 2) - 3 = 6n^2 - 9n - 9     = Theta(n^2)
w = n-1 (最大) : T = (n-1)(2n^2 - 3n - 2) - 3 = 2n^3 - 5n^2 + n - 1 = Theta(n^3)
```

n=6 の場合: T = 257 = 2(216) - 5(36) + 6 - 1 = 432 - 180 + 6 - 1 = 257。検証済み。

### パス長比較（w 変種）

| w | T | 公式 |
|---|---|---|
| 3 | 153 | 3 * 52 - 3 |
| 4 | 205 | 4 * 52 - 3 |
| 5 | 257 | 5 * 52 - 3 |

## 迷路

```
normal: W0->N0, N0->N4, N0->S0, S4->N3, S3->N2, S2->N1, S1->E5, E5->W4, W4->E0, N1->W0, E0->W5, E4->W3, E3->W2, E2->S1, W2->W1; nx: (none); ny: (none)
```

## パス（257ステップ）

```
(0,1,E0) -> (1,1,N0) -> (1,1,N4) -> (1,2,N3) -> (1,3,N2) -> (1,4,N1) -> (1,5,E5) -> (0,5,E4) -> (1,5,E0) -> (2,5,N0) -> (2,5,N4) -> (2,6,N3) -> (2,7,N2) -> (2,8,N1) -> (2,9,E5) -> (1,9,E4) -> (2,9,E0) -> (3,9,N0) -> (3,9,N4) -> (3,10,N3) -> (3,11,N2) -> (3,12,N1) -> (3,13,E5) -> (2,13,E4) -> (3,13,E0) -> (4,13,N0) -> (4,13,N4) -> (4,14,N3) -> (4,15,N2) -> (4,16,N1) -> (4,17,E5) -> (3,17,E4) -> (4,17,E0) -> (5,17,N0) -> (5,17,N4) -> (5,18,N3) -> (5,19,N2) -> (5,20,N1) -> (5,21,E5) -> (4,21,E4) -> (5,21,E0) -> (6,21,N0) -> (6,21,N4) -> (6,22,N3) -> (6,23,N2) -> (6,24,N1) -> (6,25,E5) -> (5,25,E4) -> (6,25,E0) -> (7,25,N0) -> (7,25,N4) -> (7,26,N3) -> (7,27,N2) -> (7,28,N1) -> (7,29,E5) -> (6,29,E4) -> (7,29,E0) -> (8,29,N0) -> (8,29,N4) -> (8,30,N3) -> (8,31,N2) -> (8,32,N1) -> (8,33,E5) -> (7,33,E4) -> (8,33,E0) -> (9,33,N0) -> (9,33,N4) -> (9,34,N3) -> (9,35,N2) -> (9,36,N1) -> (9,37,E5) -> (8,37,E4) -> (9,37,E0) -> (10,37,N0) -> (10,37,N4) -> (10,38,N3) -> (10,39,N2) -> (10,40,N1) -> (10,41,E5) -> (9,41,E4) -> (10,41,E0) -> (11,41,N0) -> (11,41,N4) -> (11,42,N3) -> (11,43,N2) -> (11,44,N1) -> (11,45,E5) -> (10,45,E4) -> (11,45,E0) -> (12,45,N0) -> (12,45,N4) -> (12,46,N3) -> (12,47,N2) -> (12,48,N1) -> (12,49,E5) -> (11,49,E4) -> (12,49,E0) -> (13,49,N0) -> (13,49,N4) -> (13,50,N3) -> (13,51,N2) -> (13,52,N1) -> (13,53,E5) -> (12,53,E4) -> (13,53,E0) -> (14,53,N0) -> (14,53,N4) -> (14,54,N3) -> (14,55,N2) -> (14,56,N1) -> (14,57,E5) -> (13,57,E4) -> (14,57,E0) -> (15,57,N0) -> (15,57,N4) -> (15,58,N3) -> (15,59,N2) -> (15,60,N1) -> (15,61,E5) -> (14,61,E4) -> (15,61,E0) -> (16,61,N0) -> (16,61,N4) -> (16,62,N3) -> (16,63,N2) -> (16,64,N1) -> (16,65,E5) -> (15,65,E4) -> (16,65,E0) -> (17,65,N0) -> (17,65,N4) -> (17,66,N3) -> (17,67,N2) -> (17,68,N1) -> (17,69,E5) -> (16,69,E4) -> (17,69,E0) -> (18,69,N0) -> (18,69,N4) -> (18,70,N3) -> (18,71,N2) -> (18,72,N1) -> (18,73,E5) -> (17,73,E4) -> (18,73,E0) -> (19,73,N0) -> (19,73,N4) -> (19,74,N3) -> (19,75,N2) -> (19,76,N1) -> (19,77,E5) -> (18,77,E4) -> (19,77,E0) -> (20,77,N0) -> (20,76,N0) -> (20,75,N0) -> (20,74,N0) -> (20,73,N0) -> (20,72,N0) -> (20,71,N0) -> (20,70,N0) -> (20,69,N0) -> (20,68,N0) -> (20,67,N0) -> (20,66,N0) -> (20,65,N0) -> (20,64,N0) -> (20,63,N0) -> (20,62,N0) -> (20,61,N0) -> (20,60,N0) -> (20,59,N0) -> (20,58,N0) -> (20,57,N0) -> (20,56,N0) -> (20,55,N0) -> (20,54,N0) -> (20,53,N0) -> (20,52,N0) -> (20,51,N0) -> (20,50,N0) -> (20,49,N0) -> (20,48,N0) -> (20,47,N0) -> (20,46,N0) -> (20,45,N0) -> (20,44,N0) -> (20,43,N0) -> (20,42,N0) -> (20,41,N0) -> (20,40,N0) -> (20,39,N0) -> (20,38,N0) -> (20,37,N0) -> (20,36,N0) -> (20,35,N0) -> (20,34,N0) -> (20,33,N0) -> (20,32,N0) -> (20,31,N0) -> (20,30,N0) -> (20,29,N0) -> (20,28,N0) -> (20,27,N0) -> (20,26,N0) -> (20,25,N0) -> (20,24,N0) -> (20,23,N0) -> (20,22,N0) -> (20,21,N0) -> (20,20,N0) -> (20,19,N0) -> (20,18,N0) -> (20,17,N0) -> (20,16,N0) -> (20,15,N0) -> (20,14,N0) -> (20,13,N0) -> (20,12,N0) -> (20,11,N0) -> (20,10,N0) -> (20,9,N0) -> (20,8,N0) -> (20,7,N0) -> (20,6,N0) -> (20,5,N0) -> (20,4,N0) -> (20,3,N0) -> (20,2,N0) -> (20,1,N0) -> (20,1,N4) -> (20,2,N3) -> (20,3,N2) -> (20,4,N1) -> (19,4,E0) -> (18,4,E5) -> (17,4,E4) -> (16,4,E3) -> (15,4,E2) -> (15,3,N1) -> (14,3,E0) -> (13,3,E5) -> (12,3,E4) -> (11,3,E3) -> (10,3,E2) -> (10,2,N1) -> (9,2,E0) -> (8,2,E5) -> (7,2,E4) -> (6,2,E3) -> (5,2,E2) -> (5,1,N1) -> (4,1,E0) -> (3,1,E5) -> (2,1,E4) -> (1,1,E3) -> (0,1,E2) -> (0,1,E1)
```
